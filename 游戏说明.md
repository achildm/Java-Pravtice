# Java网络象棋游戏 - 使用说明

## 项目概述

这是一个完整的基于Java Swing和Socket网络编程的象棋游戏，实现了类似QQ游戏的功能。

## 最新改进 ✨

### 1. 修正了棋子布局问题
- **修正前**: 兵的位置被象替代，炮的位置被士替代，棋子顺序错误
- **修正后**: 正确的象棋布局 - 车马象士将士象马车，兵和炮位置正确

### 2. 全新登录界面设计
- 仿QQ游戏风格的85个头像选择网格（9x11布局）
- 服务器地址输入框（默认192.168.0.100）
- 连接、重置、退出三个功能按钮
- 选中头像高亮显示效果

### 3. 重新设计的游戏大厅
- 15个房间网格布局（5x3），每个房间显示房间号
- 蓝色主题背景，仿QQ游戏大厅风格
- 右侧用户信息面板显示头像和个人信息
- 底部聊天室支持实时聊天
- 点击房间或"加入"按钮开始匹配

## 主要功能

### 1. 登录界面
- 用户名输入
- 服务器地址配置
- 85个头像网格选择
- 连接状态显示

### 2. 游戏大厅
- 15个房间展示
- 匹配系统：点击房间或"加入"按钮
- 聊天功能：与其他在线玩家聊天
- 用户信息面板：显示头像、等级、胜率

### 3. 象棋对战界面
- 完整的象棋规则实现
- 正确的棋子初始布局
- 实时对战功能
- 游戏计时（10分钟倒计时）
- 音效支持（移动、选择、将军等）
- 游戏结束判定

## 技术特性

### 网络通信
- 基于Socket的TCP连接
- 序列化对象传输
- 多线程处理客户端连接
- 心跳包机制

### 游戏逻辑
- 完整的象棋规则验证
- 棋子移动合法性检查
- 游戏状态管理
- 胜负判定

### 用户界面
- Swing GUI界面
- 自定义绘制棋盘
- 图片资源加载
- 响应式布局

## 快速开始

### 第一步：编译项目
```bash
mvn clean compile
```

### 第二步：启动服务器
在一个命令行窗口中运行：
```bash
java -cp target/classes com.achldm.chess.ChessGameMain server
```
或者双击 `start-server.bat`

### 第三步：启动客户端
在另一个命令行窗口中运行：
```bash
java -cp target/classes com.achldm.chess.ChessGameMain
```
或者双击 `start-client.bat`

### 第四步：开始游戏
1. 在登录界面选择头像，输入用户名
2. 设置服务器地址（默认192.168.0.100:8888）
3. 点击连接进入大厅
4. 在大厅中点击任意房间或点击"加入"按钮开始匹配
5. 需要两个客户端都进行匹配才能开始游戏
6. 匹配成功后自动进入游戏界面，红方先行

## 游戏规则

### 基本规则
- 红方先行
- 轮流下棋
- 将死对方获胜
- 超时判负（10分钟）

### 棋子移动规则（已修正）
1. **帅/将**：只能在九宫格内移动，每次一格（横竖）
2. **仕/士**：只能在九宫格内斜着移动
3. **相/象**：斜着走两格，不能过河，不能被蹩脚
4. **马**：走日字，不能被蹩脚
5. **车**：走直线，路径不能有其他棋子
6. **炮**：走直线，吃子时中间必须有且仅有一个棋子
7. **兵/卒**：只能向前，过河后可以左右移动

### 正确的棋子布局
```
黑方: 车马象士将士象马车
      空空炮空空空炮空空
      卒空卒空卒空卒空卒
      空空空空空空空空空
      空空空空空空空空空
      兵空兵空兵空兵空兵
      空空炮空空空炮空空
红方: 车马相仕帅仕相马车
```

### 操作说明
- 点击棋子选中（会显示红色边框）
- 再次点击目标位置移动
- 点击同一棋子取消选择
- 只能移动己方棋子
- 只能在自己回合移动

## 界面截图对应

### 登录界面特点
- 85个头像网格选择
- 服务器地址输入
- 连接/重置/退出按钮

### 大厅界面特点  
- 15个房间网格布局
- 蓝色背景主题
- 右侧用户信息和聊天区

### 游戏界面特点
- 正确的象棋布局
- 实时计时显示
- 音效反馈

## 资源文件说明

### 棋子图片 (qizi文件夹)
- 1-7.gif：红方棋子（帅、仕、相、马、车、炮、兵）
- 17-23.gif：黑方棋子（将、士、象、马、车、炮、卒）
- xqboard.gif：棋盘背景
- select.gif：选中框

### 头像图片 (face文件夹)
- 1-1.gif 到 85-3.gif：用户头像选择

### 音效文件 (audio文件夹)
- go.wav：移动棋子音效
- select.wav：选择棋子音效
- jiang.wav：将军音效
- eat.wav：吃子音效

## 网络协议

### 消息类型
- LOGIN：登录请求
- LOGIN_SUCCESS/LOGIN_FAILED：登录结果
- MATCH_REQUEST：匹配请求
- MATCH_FOUND：匹配成功
- MOVE：棋子移动
- GAME_OVER：游戏结束
- CHAT：聊天消息
- HEARTBEAT：心跳包

### 连接流程
1. 客户端连接服务器（默认localhost:8888）
2. 发送登录消息
3. 服务器验证并返回结果
4. 进入大厅，可以匹配和聊天
5. 匹配成功后进入游戏

## 故障排除

### 常见问题

1. **连接服务器失败**
   - 确保服务器已启动
   - 检查端口8888是否被占用
   - 确认防火墙设置
   - 检查服务器地址是否正确

2. **界面显示异常**
   - 检查资源文件是否完整
   - 确认Java版本（需要Java 17+）

3. **头像不显示**
   - 检查face文件夹中的gif文件
   - 确认图片路径正确

4. **音效无法播放**
   - 检查音频文件是否存在
   - 确认系统音频设置

5. **游戏卡顿**
   - 检查网络连接
   - 重启客户端

### 调试信息
- 服务器会在控制台输出连接和游戏信息
- 客户端异常会显示在控制台
- 可以通过日志排查问题

## 扩展开发

### 可以添加的功能
1. 数据库存储用户信息
2. 游戏记录和回放
3. 排行榜系统
4. 更多游戏模式
5. 观战功能
6. 悔棋功能
7. 断线重连
8. 更丰富的聊天功能

### 代码结构
- `client`包：客户端相关代码
- `server`包：服务器端代码
- `game`包：游戏逻辑
- `common`包：公共类和消息定义

项目采用了良好的分层架构，便于维护和扩展。

## 更新日志

### v1.1 (当前版本)
- ✅ 修正了棋子布局问题（车马象士将士象马车）
- ✅ 重新设计登录界面，85个头像网格选择
- ✅ 重新设计游戏大厅，15个房间布局
- ✅ 添加服务器地址配置功能
- ✅ 改进用户界面，更接近QQ游戏风格

### v1.0 (初始版本)
- ✅ 基本的网络象棋游戏功能
- ✅ 登录、大厅、游戏三个界面
- ✅ 完整的象棋规则实现
- ✅ 音效和计时功能